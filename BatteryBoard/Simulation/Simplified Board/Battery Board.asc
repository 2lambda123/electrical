Version 4
SHEET 1 5144 2508
WIRE -592 -768 -640 -768
WIRE -496 -768 -528 -768
WIRE -640 -656 -640 -768
WIRE 352 -544 208 -544
WIRE 656 -544 352 -544
WIRE 864 -544 656 -544
WIRE 352 -480 352 -544
WIRE 656 -448 656 -544
WIRE -640 -400 -640 -576
WIRE -496 -400 -640 -400
WIRE -640 -352 -640 -400
WIRE 864 -336 864 -544
WIRE 656 -320 656 -368
WIRE 752 -320 656 -320
WIRE 832 -320 752 -320
WIRE 1008 -304 896 -304
WIRE 304 -288 208 -288
WIRE 352 -288 352 -400
WIRE 352 -288 304 -288
WIRE 400 -288 352 -288
WIRE 528 -288 480 -288
WIRE 752 -288 528 -288
WIRE 832 -288 752 -288
WIRE 656 -208 656 -320
WIRE 304 -192 304 -288
WIRE 416 -192 304 -192
WIRE 528 -192 528 -288
WIRE 528 -192 480 -192
WIRE 1008 -176 1008 -304
WIRE 1024 -176 1008 -176
WIRE 1184 -176 1024 -176
WIRE -544 -160 -784 -160
WIRE 528 -160 528 -192
WIRE 1024 -144 1024 -176
WIRE 528 -64 528 -96
WIRE 528 -64 272 -64
WIRE 656 -64 656 -128
WIRE 656 -64 528 -64
WIRE 864 -64 864 -272
WIRE 864 -64 656 -64
WIRE 1024 -64 1024 -80
WIRE 1024 -64 864 -64
WIRE -784 -16 -784 -160
WIRE -784 224 -784 64
WIRE -544 224 -784 224
WIRE 1632 320 1584 320
WIRE 1872 320 1712 320
WIRE 2048 320 1872 320
WIRE 1872 384 1872 320
WIRE 1344 432 1296 432
WIRE 1440 432 1344 432
WIRE 1584 432 1584 320
WIRE 1584 432 1520 432
WIRE 1808 432 1584 432
WIRE -432 640 -720 640
WIRE 1872 672 1872 480
WIRE 1872 672 1632 672
WIRE 1632 752 1632 672
WIRE 1872 768 1872 672
WIRE -720 784 -720 640
WIRE 1872 896 1872 768
WIRE 3024 928 2896 928
WIRE 1632 944 1632 832
WIRE 1632 944 1440 944
WIRE 1856 944 1632 944
WIRE 2144 944 1952 944
WIRE -720 1008 -720 864
WIRE -432 1008 -720 1008
WIRE 480 1008 320 1008
WIRE 528 1008 480 1008
WIRE 640 1008 608 1008
WIRE 816 1008 640 1008
WIRE 3024 1104 3024 928
WIRE 1488 1232 1296 1232
WIRE 1664 1232 1488 1232
WIRE 1488 1312 1488 1232
WIRE 3024 1376 3024 1168
WIRE 3024 1376 2896 1376
WIRE 1664 1472 1664 1232
WIRE 1488 1520 1488 1392
WIRE 1488 1520 1296 1520
WIRE 1648 1520 1488 1520
WIRE 1872 1520 1744 1520
WIRE 2144 1520 1952 1520
WIRE 352 1696 144 1696
WIRE 688 1696 688 1600
WIRE 688 1696 576 1696
WIRE 752 1696 688 1696
WIRE 880 1696 832 1696
WIRE -448 1744 -656 1744
WIRE -336 1744 -448 1744
WIRE -224 1744 -336 1744
WIRE 352 1760 -128 1760
WIRE 880 1760 880 1696
WIRE 880 1760 576 1760
WIRE -656 1824 -656 1744
WIRE -448 1824 -448 1744
WIRE -224 1824 -224 1744
WIRE 352 1824 144 1824
WIRE 880 1824 880 1760
WIRE 880 1824 576 1824
WIRE 880 1856 880 1824
WIRE 352 1888 144 1888
WIRE 656 1888 576 1888
WIRE -656 2000 -656 1904
WIRE -656 2000 -848 2000
WIRE -576 2000 -656 2000
WIRE -448 2000 -448 1904
WIRE -448 2000 -512 2000
WIRE -224 2000 -224 1888
WIRE -224 2000 -448 2000
WIRE -128 2000 -128 1760
WIRE -128 2000 -224 2000
WIRE 880 2000 880 1936
WIRE 656 2128 656 1952
WIRE 656 2128 448 2128
WIRE 880 2128 880 2064
WIRE 880 2128 656 2128
FLAG 2048 320 15VO
FLAG 1296 432 MAIN_FET_EN_L
FLAG 1440 944 BMS_GND
FLAG 2144 944 SYSTEM_GND
FLAG 1296 1520 BMS_GND
FLAG 1296 1232 PRECHG_FET_EN
FLAG 2144 1520 SYSTEM_GND
FLAG 208 -544 15VO
FLAG 208 -288 BMS_DISCHARGE_EN_L
FLAG 1184 -176 MAIN_FET_EN_L
FLAG 688 1600 15VO
FLAG 144 1824 PRECHG_FET_EN
FLAG 144 1888 15VO
FLAG -848 2000 BMS_DISCHARGE_EN_L
FLAG 816 1008 BMS_GND
FLAG 320 1008 CELL_1_NEG
FLAG -432 640 CELL_10_POS
FLAG -432 1008 CELL_1_NEG
FLAG -544 -160 15VO
FLAG 272 -64 BMS_GND
FLAG 144 1696 BMS_GND
FLAG 448 2128 BMS_GND
FLAG -544 224 BMS_GND
FLAG -496 -768 BMS_DISCHARGE_EN_L
FLAG -496 -400 BMS_GND
FLAG 2896 1376 SYSTEM_GND
FLAG 2896 928 CELL_10_POS
FLAG -640 -352 0
FLAG -336 1744 15VO
FLAG 752 -288 +
FLAG 752 -320 -
DATAFLAG 1488 1232 "$"
DATAFLAG 480 1008 "$"
DATAFLAG 640 1008 "$"
DATAFLAG 1344 432 "$"
DATAFLAG 1872 768 "$"
SYMBOL pnp 1808 480 M180
SYMATTR InstName Q1
SYMBOL res 1536 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res 1728 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1Meg
SYMBOL res 1616 736 R0
SYMATTR InstName R1
SYMATTR Value 1Meg
SYMBOL nmos 1952 896 R90
SYMATTR InstName M1
SYMATTR Value IPP045N10N3
SYMBOL NE555 464 1792 R0
SYMATTR InstName U2
SYMBOL opamp2 864 -368 R0
SYMATTR InstName U1
SYMATTR Value TL071
SYMBOL res 1472 1296 R0
SYMATTR InstName R4
SYMATTR Value 1Meg
SYMBOL res 1968 1504 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 5.6k
SYMBOL nmos 1744 1472 R90
SYMATTR InstName M2
SYMBOL res 640 -464 R0
SYMATTR InstName R6
SYMATTR Value 500k
SYMBOL res 640 -224 R0
SYMATTR InstName R7
SYMATTR Value 500k
SYMBOL res 496 -304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1Meg
SYMBOL cap 512 -160 R0
SYMATTR InstName C1
SYMATTR Value 68n IC=15
SYMBOL diode 416 -176 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMBOL res 336 -496 R0
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL cap 640 1888 R0
SYMATTR InstName C2
SYMATTR Value 0.1µ
SYMBOL res 864 1840 R0
SYMATTR InstName R11
SYMATTR Value 2.2k
SYMBOL res 848 1680 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 1Meg
SYMBOL cap 864 2000 R0
SYMATTR InstName C3
SYMATTR Value 0.1µ
SYMBOL res -672 1808 R0
SYMATTR InstName R13
SYMATTR Value 2k
SYMBOL res -464 1808 R0
SYMATTR InstName R14
SYMATTR Value 2k
SYMBOL diode -208 1888 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL cap -512 1984 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 0.1µ
SYMBOL res 624 992 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 0.001
SYMBOL battery -720 768 R0
SYMATTR InstName V1
SYMATTR Value 30
SYMATTR SpiceLine Rser=500m
SYMBOL voltage -784 -32 R0
SYMATTR InstName V2
SYMATTR Value 15
SYMBOL voltage -640 -672 R0
SYMATTR InstName V3
SYMATTR Value PWL(0 15 .005 15 .0051 0)
SYMBOL diode -528 -784 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMBOL cap 3008 1104 R0
SYMATTR InstName C5
SYMATTR Value 100µ IC=0
SYMBOL cap 1008 -144 R0
SYMATTR InstName C6
SYMATTR Value 1p IC=15
TEXT 1136 -432 Left 2 !.inc TL071.lib
TEXT -808 392 Left 2 !.tran 1m 150m uic
TEXT -808 552 Left 2 ;Battery simulation\nInternal resistance: ~100mOhm per cell, *10/2 (because 10S2P) = 500mOhm
TEXT 232 840 Left 2 ;Sense resistor
TEXT 1112 144 Left 2 ;Main FET
TEXT 40 -688 Left 2 ;Main FET Timer
TEXT 1120 1120 Left 2 ;Pre-charge FET
TEXT -1224 1464 Left 2 ;Pre-charge FET Timer
TEXT -816 312 Left 2 ;Analysis Setup\n1000ms simulation in 1ms increments
TEXT -824 -240 Left 2 ;15V Linear regulator
TEXT 2616 848 Left 2 ;System Load
RECTANGLE Normal -836 512 100 1068 2
RECTANGLE Normal 140 816 972 1068 2
RECTANGLE Normal 1072 108 2380 1060 2
RECTANGLE Normal -160 -720 1488 36 2
RECTANGLE Normal 1068 1084 2372 1648 2
RECTANGLE Normal -1268 1424 1012 2336 2
RECTANGLE Normal 1112 -460 1328 -392 2
RECTANGLE Normal -856 296 -332 488 2
RECTANGLE Normal -864 -276 -304 256 2
RECTANGLE Normal 2580 824 3200 1448 2
